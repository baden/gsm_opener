<!doctype html>
<html lang="en">

<head>
    <meta name="description" content="GSM Opener prototype" />
    <meta name="author" content="Denys Batrak">
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> -->
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densityDpi=device-dpi"> -->
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->

    <!-- <base href="/gsm_opener/"> -->
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="manifest" href="manifest.json">

    <title>GSM opener</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Extended"
      rel="stylesheet"> -->

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="GSM opener">
    <meta name="apple-mobile-web-app-title" content="GSM opener">
    <!-- <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> -->
    <meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">
    <meta name="msapplication-navbutton-color" content="#ffe3ff">
    <meta name="msapplication-starturl" content="./index.html">

    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
    <link rel="manifest" href="./manifest.json">
    <link rel="mask-icon" href="./safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffe400">
<link href="styles.css" rel="stylesheet"></head>

<body style="padding:0; margin:0;-webkit-flex:1">
    <!-- <div class="header" style="width: 100%; height: 64px; background-color: blue"></div> -->
    <section id="elm-app"> TBD31 </section>

    <div style="text-align: center; padding-top:100px">
        <i class="material-icons" style="font-size: 128px">face</i>
        <p>Нажмите чтобы открыть замок.</p>
    </div>
    <div id="Update" style="display:none">Доступна новая версия</div>

    <script>
        var updater = document.getElementById('Update');

      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
        .then(function(registration) {
          console.log('Service Worker registration successful with scope: ',
           registration.scope);
          console.dir(registration);
          registration.onupdatefound = function() {
              const installingWorker = registration.installing;
            //   https://medium.com/@zwacky/pwa-create-a-new-update-available-notification-using-service-workers-18be9168d717
              installingWorker.onstatechange = function() {
              						switch (installingWorker.state) {
              							case 'installed':
              								if (navigator.serviceWorker.controller) {
                                                console.log("update found!");
                                                updater.style = "";
                                                // window.location.reload();
                                                // if (confirm('Доступна новая версия сайта. Перезагрузить страницу?')) {
                                                //   window.location.reload();
                                                // }

              									// new update available
              							// 		resolve(true);
              								} else {
                                                console.log("no update found!");
              									// no update available
              							// 		resolve(false);
              								}
              								break;
              						}
              					};
          }
        })
        .catch(function(err) {
          console.log(err);
        });
      }

      if(window.applicationCache){
        // var appCache = window.applicationCache;
        window.addEventListener('load', function(e) {
          window.applicationCache.addEventListener('updateready', function() {
            if (window.applicationCache.status === window.applicationCache.UPDATEREADY) {
              // alert('found new version!');
              // window.applicationCache.swapCache();
              if (confirm('Доступна новая версия сайта. Перезагрузить страницу?')) {
                window.location.reload();
              }
            } else {
              // Manifest didn't changed. Nothing new to server.
            }
          }, false);
        }, false);
      }


      </script>
<script type="text/javascript" src="js/app-f8167e1f0967c5246b65.js"></script></body>
</html>
